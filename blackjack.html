<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black Jack - CDDC</title>
    <style>
        /* Existing styles remain unchanged */
        /* ... */
        
        /* Add styles for split hands */
        .split-hands {
            display: flex;
            justify-content: space-around;
        }
        .split-hand {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Black Jack</h1>
        <p>Welcome to Black Jack! Play Smart, Win Big!</p>
        <div id="tokens-display">Tokens: <span id="tokens">1000</span></div>
        <div id="game-area">
            <h2>Dealer's Hand</h2>
            <div class="score">Score: <span id="dealer-score"></span></div>
            <div id="dealer-hand" class="hand"></div>
            <h2>Your Hand</h2>
            <div id="player-hands" class="split-hands">
                <div class="split-hand">
                    <div class="score">Score: <span id="player-score-1"></span></div>
                    <div id="player-hand-1" class="hand"></div>
                </div>
                <div class="split-hand" style="display: none;">
                    <div class="score">Score: <span id="player-score-2"></span></div>
                    <div id="player-hand-2" class="hand"></div>
                </div>
            </div>
            <div id="actions">
                <button id="hit">Hit</button>
                <button id="stand">Stand</button>
                <button id="double">Double</button>
                <button id="split">Split</button>
            </div>
            <div id="chip-stack"></div>
            <div id="bet-area">
                <input type="number" id="bet-amount" min="10" step="10" value="10">
                <button id="place-bet">Place Bet</button>
            </div>
            <p id="message"></p>
        </div>
        <a href="individuals.html">Back to Games</a>
    </div>
    <script>
        // Game state
        let deck = [];
        let playerHands = [[], []];
        let dealerHand = [];
        let playerScores = [0, 0];
        let dealerScore = 0;
        let tokens = 1000;
        let currentBet = 0;
        let gameInProgress = false;
        let currentHand = 0;
        let splitActive = false;

        // DOM elements
        const dealerHandEl = document.getElementById('dealer-hand');
        const playerHandEls = [document.getElementById('player-hand-1'), document.getElementById('player-hand-2')];
        const dealerScoreEl = document.getElementById('dealer-score');
        const playerScoreEls = [document.getElementById('player-score-1'), document.getElementById('player-score-2')];
        const hitButton = document.getElementById('hit');
        const standButton = document.getElementById('stand');
        const doubleButton = document.getElementById('double');
        const splitButton = document.getElementById('split');
        const betButton = document.getElementById('place-bet');
        const betInput = document.getElementById('bet-amount');
        const tokensEl = document.getElementById('tokens');
        const messageEl = document.getElementById('message');

        // Existing functions remain largely unchanged
        // createDeck(), shuffleDeck(), dealCard(), calculateScore(), createCardElement()

        // Update UI
        function updateUI() {
            dealerHandEl.innerHTML = '';
            playerHandEls[0].innerHTML = '';
            playerHandEls[1].innerHTML = '';

            dealerHand.forEach((card, index) => {
                const cardEl = createCardElement(card, index === 0 || !gameInProgress);
                dealerHandEl.appendChild(cardEl);
            });

            playerHands.forEach((hand, index) => {
                hand.forEach(card => {
                    const cardEl = createCardElement(card);
                    playerHandEls[index].appendChild(cardEl);
                });
            });

            dealerScoreEl.textContent = gameInProgress ? '?' : dealerScore;
            playerScoreEls[0].textContent = playerScores[0];
            playerScoreEls[1].textContent = playerScores[1];
            tokensEl.textContent = tokens;
            updateChipStack();

            // Show/hide split hand
            document.querySelector('.split-hand:nth-child(2)').style.display = splitActive ? 'block' : 'none';
        }

        // Start new game
        function startNewGame() {
            createDeck();
            shuffleDeck();
            playerHands = [[dealCard(), dealCard()], []];
            dealerHand = [dealCard(), dealCard()];
            playerScores = [calculateScore(playerHands[0]), 0];
            dealerScore = calculateScore(dealerHand);
            gameInProgress = true;
            currentHand = 0;
            splitActive = false;
            updateUI();
            checkForBlackjack();
            updateSplitButton();
        }

        // Check for blackjack
        function checkForBlackjack() {
            if (playerScores[0] === 21) {
                endGame('Blackjack! You win!');
                tokens += Math.floor(currentBet * 2.5);
            } else if (dealerScore === 21) {
                endGame('Dealer has Blackjack. You lose.');
                tokens -= currentBet;
            }
        }

        // Player hit
        function playerHit() {
            playerHands[currentHand].push(dealCard());
            playerScores[currentHand] = calculateScore(playerHands[currentHand]);
            updateUI();
            if (playerScores[currentHand] > 21) {
                if (splitActive && currentHand === 0) {
                    currentHand = 1;
                    updateUI();
                } else {
                    endGame('Bust! You lose.');
                    tokens -= currentBet * (splitActive ? 2 : 1);
                }
            }
        }

        // Player stand
        function playerStand() {
            if (splitActive && currentHand === 0) {
                currentHand = 1;
                updateUI();
            } else {
                gameInProgress = false;
                while (dealerScore < 17) {
                    dealerHand.push(dealCard());
                    dealerScore = calculateScore(dealerHand);
                }
                updateUI();
                determineWinner();
            }
        }

        // Player double
        function playerDouble() {
            if (tokens >= currentBet * 2) {
                tokens -= currentBet;
                currentBet *= 2;
                playerHit();
                if (playerScores[currentHand] <= 21) {
                    playerStand();
                }
            } else {
                messageEl.textContent = 'Not enough tokens to double.';
            }
        }

        // Player split
        function playerSplit() {
            if (playerHands[0][0].value === playerHands[0][1].value && tokens >= currentBet * 2) {
                splitActive = true;
                playerHands[1].push(playerHands[0].pop());
                playerHands[0].push(dealCard());
                playerHands[1].push(dealCard());
                playerScores = [calculateScore(playerHands[0]), calculateScore(playerHands[1])];
                tokens -= currentBet;
                updateUI();
                updateSplitButton();
            } else {
                messageEl.textContent = 'Cannot split these cards or not enough tokens.';
            }
        }

        // Determine winner
        function determineWinner() {
            let message = '';
            let totalWin = 0;

            for (let i = 0; i <= (splitActive ? 1 : 0); i++) {
                if (playerScores[i] > 21) {
                    message += `Hand ${i + 1}: Bust. `;
                } else if (dealerScore > 21 || playerScores[i] > dealerScore) {
                    message += `Hand ${i + 1}: You win! `;
                    totalWin += currentBet;
                } else if (dealerScore > playerScores[i]) {
                    message += `Hand ${i + 1}: Dealer wins. `;
                    totalWin -= currentBet;
                } else {
                    message += `Hand ${i + 1}: It's a tie. `;
                }
            }

            tokens += totalWin;
            endGame(message.trim());
        }

        // End game
        function endGame(message) {
            gameInProgress = false;
            messageEl.textContent = message;
            hitButton.disabled = true;
            standButton.disabled = true;
            doubleButton.disabled = true;
            splitButton.disabled = true;
            betButton.disabled = false;
            betInput.disabled = false;
            updateUI();
        }

        // Place bet
        function placeBet() {
            const betAmount = parseInt(betInput.value);
            if (betAmount > tokens) {
                messageEl.textContent = 'Not enough tokens.';
                return;
            }
            if (betAmount < 10) {
                messageEl.textContent = 'Minimum bet is 10 tokens.';
                return;
            }
            currentBet = betAmount;
            tokens -= currentBet;
            startNewGame();
            hitButton.disabled = false;
            standButton.disabled = false;
            doubleButton.disabled = false;
            betButton.disabled = true;
            betInput.disabled = true;
            messageEl.textContent = '';
            updateChipStack();
        }

        // Update split button
        function updateSplitButton() {
            splitButton.disabled = !(playerHands[0].length === 2 && playerHands[0][0].value === playerHands[0][1].value && tokens >= currentBet);
        }

        // Event listeners
        hitButton.addEventListener('click', playerHit);
        standButton.addEventListener('click', playerStand);
        doubleButton.addEventListener('click', playerDouble);
        splitButton.addEventListener('click', playerSplit);
        betButton.addEventListener('click', placeBet);

        // Initialize
        hitButton.disabled = true;
        standButton.disabled = true;
        doubleButton.disabled = true;
        splitButton.disabled = true;
        updateChipStack();

        // Set maximum bet to current token amount
        function updateMaxBet() {
            betInput.max = tokens;
        }

        // Update max bet when tokens change
        const tokenObserver = new MutationObserver(updateMaxBet);
        tokenObserver.observe(tokensEl, { childList: true });
    </script>
</body>
</html>
